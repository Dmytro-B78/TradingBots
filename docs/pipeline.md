# pipeline.py — Отбор торговых пар

Модуль `pipeline.py` отвечает за полный цикл отбора торговых пар на основе конфигурации, рыночных условий и стратегии.

---

## 📌 1. select_pairs(cfg)

**Назначение:**  
Отбирает пары по объёму, спреду, тренду и стратегии.

**Вход:**  
- `cfg`: объект конфигурации (dict-like), содержит лимиты, фильтры, режимы

**Выход:**  
- Список словарей:  
  `[{"pair": "BTC/USDT", "regime": "uptrend", "strategy": "adaptive"}, ...]`

**Зависимости:**  
- `ccxt.fetch_ticker()`  
- `detect_regime()`  
- `detect_strategy()`  
- `filters.py` (объём, спред, тренд)

---

## 📦 2. fetch_and_filter_pairs(cfg, use_cache=True, cache_ttl_hours=24)

**Назначение:**  
Загружает whitelist из кэша или вызывает `select_pairs()`.

**Кэш:**  
- Файл: `whitelist.json`  
- TTL: по умолчанию 24 часа

**Вход:**  
- `cfg`: объект конфигурации  
- `use_cache`: логический флаг  
- `cache_ttl_hours`: время жизни кэша

**Выход:**  
- Список строк:  
  `["BTC/USDT", "ETH/USDT", ...]`

---

## 📊 3. show_top_pairs(cfg, pairs)

**Назначение:**  
Логирует объёмы по парам.

**Поведение:**  
- Вызывает `ccxt.fetch_ticker()`  
- Пишет в лог: `volume=123456789` для каждой пары

**Вход:**  
- `cfg`: объект конфигурации  
- `pairs`: список строк

**Выход:**  
- None (побочный эффект — логгинг)

---

## 🧪 4. Покрытие тестами

- `test_select_pairs_no_cache()` — проверка отбора без кэша  
- `test_select_pairs_with_cache()` — проверка загрузки из кэша  
- `test_show_top_pairs_logs_volume()` — проверка логирования объёмов  
- `test_pipeline_end_to_end()` — интеграционный тест всего пайплайна

---

## 🛠️ TODO

- [ ] Добавить логирование причин отбраковки пар  
- [ ] Поддержка мульти-таймфрейм трендов  
- [ ] Интеграция с `strategy_chooser`  
- [ ] Поддержка исключений (whitelist/blacklist)
