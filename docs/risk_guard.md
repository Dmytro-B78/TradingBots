# risk_guard.py — Контроль рисков

Модуль `risk_guard.py` отвечает за защиту капитала: проверку лимитов, блокировку сделок и логирование нарушений.

---

## 📌 1. check_limits(position, trade, cfg)

**Назначение:**  
Проверяет, не превышает ли сделка лимиты по объёму, проценту от баланса, дневному убытку и количеству сделок.

**Вход:**  
- `position`: текущая позиция по паре  
- `trade`: параметры новой сделки  
- `cfg`: конфигурация лимитов

**Выход:**  
- `True`, если сделка допустима  
- `False`, если нарушен хотя бы один лимит

---

## 🚫 2. should_block_trade(pair, reason)

**Назначение:**  
Проверяет, заблокирована ли пара по заданной причине (`volume`, `spread`, `loss_limit`, `cooldown`).

**Вход:**  
- `pair`: строка, например `"BTC/USDT"`  
- `reason`: причина блокировки

**Выход:**  
- `True`, если пара заблокирована  
- `False`, если торговля разрешена

---

## 📝 3. log_block_event(pair, reason, details)

**Назначение:**  
Записывает событие блокировки в `risk_blocks.csv`.

**Формат записи:**  
- `timestamp`, `pair`, `reason`, `details`

---

## ⚙️ 4. load_risk_config(cfg)

**Назначение:**  
Загружает лимиты из конфигурации.

**Параметры:**  
- `max_per_trade_usdt`  
- `max_per_trade_pct`  
- `daily_loss_limit_usdt`  
- `max_spread_pct`  
- `cooldown_minutes`

---

## 🧪 5. Покрытие тестами

- `test_risk_guard_limits()` — проверка лимитов  
- `test_blocking_logic()` — логика блокировок  
- `test_log_block_event()` — корректность логирования  
- `test_risk_guard_integration()` — интеграция с TradeExecutor

---

## 🛠️ TODO

- [ ] Поддержка динамических лимитов (на основе волатильности)  
- [ ] Уведомления в Telegram при блокировках  
- [ ] Поддержка исключений (whitelist / blacklist)  
- [ ] Визуализация блокировок (график по времени)  
