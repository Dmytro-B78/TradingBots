# strategy.py — Торговые стратегии

Модуль `strategy/` содержит реализацию торговых стратегий и их фильтров. Каждая стратегия принимает конфигурацию, рыночные данные и возвращает торговые сигналы.

---

## 📌 1. Структура

- `sma_strategy.py` — стратегия на основе скользящих средних  
- `rsi_strategy.py` — стратегия на основе RSI  
- `sl_tp_wrapper.py` — обёртка для стоп-лосса и тейк-профита  
- `filters.py` — фильтры: ATR, ADX, тренд  
- `base_strategy.py` — базовый класс стратегии  

---

## ⚙️ 2. Поддерживаемые параметры

- `mode`: `"backtest"`, `"paper"`, `"live"`  
- `max_holding_period`: максимальное удержание позиции  
- `min_risk_reward_ratio`: минимальное соотношение риск/прибыль  
- `side`: 0 (long), 1 (short), 2 (оба)  
- `risk_per_trade_pct`: риск на сделку в % от баланса  
- `sl_pct`, `tp_pct`: уровни SL/TP  
- `timeframe`: `"1h"`, `"4h"`, `"1d"` и др.

---

## 🧠 3. Поведение стратегий

- Каждая стратегия реализует метод `generate_signal(df, cfg)`  
- Возвращает:  
  - `None` — если сигнала нет  
  - Словарь:  
    ```python
    {
      "side": "buy" | "sell",
      "entry": 43250.0,
      "sl": 42800.0,
      "tp": 44000.0,
      "confidence": 0.85
    }
    ```

- Стратегии используют индикаторы из `ta` и `pandas_ta`  
- Поддержка мульти-таймфрейм анализа (в разработке)

---

## 🧪 4. Покрытие тестами

- `test_sma_strategy_signal()` — проверка сигнала SMA  
- `test_rsi_strategy_thresholds()` — проверка уровней RSI  
- `test_sl_tp_wrapper_behavior()` — логика SL/TP  
- `test_strategy_filter_chain()` — фильтрация по ATR, ADX, тренду  
- `test_strategy_config_validation()` — валидация параметров

---

## 🛠️ TODO

- [ ] Поддержка мульти-таймфрейм фильтров  
- [ ] Адаптивные параметры (на основе волатильности)  
- [ ] Визуализация сигналов (plotly / matplotlib)  
- [ ] Поддержка пользовательских стратегий через YAML/JSON  
- [ ] Библиотека шаблонов стратегий  
