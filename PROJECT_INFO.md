# NeuroTrade (NT) — Паспорт проекта

## 1. Название и версия
- Полное название: **NeuroTrade**
- Сокращение: **NT**
- Версия: **0.3** — интеграция системы уведомлений и предохранителей

## 2. Цель
Создать AI‑адаптивного торгового бота с:
- автоматическим отбором пар,
- динамическими SL/TP,
- жёсткими предохранителями,
- прозрачным управлением,
- централизованной системой уведомлений о сделках и рисках.

Основа — принципы и архитектура Cryptonna Smart Bot, адаптированные под требования безопасности и контроля.

## 3. Дорожная карта (MVP)

**Этап 1 (День 1–2)** — структура проекта, конфиг, RiskGuard, Notifier.  
**Этап 2 (День 3–6)** — модуль отбора пар (D1 + LTF).  
**Этап 3 (День 7–9)** — AI‑адаптивная стратегия.  
**Этап 4 (День 10–12)** — исполнение, тесты, диагностика.  
**Этап 5 (День 13–14)** — paper‑прогон, ограниченный live.

---

### Версия 0.3 (сентябрь 2025)
- ✅ Исправлен баг с повторным заголовком в `trades_log.csv` (`executor.py`).
- ✅ Все тесты пройдены успешно (`pytest -v`).
- ✅ Созданы резервные копии проекта до и после обновления паспорта.
- ✅ Дорожная карта актуализирована.

---

### Версия 0.4 — план работ
**Цель:** Повысить надёжность логирования и расширить тестовое покрытие.

**Задачи:**
1. **Оптимизация логирования сделок**  
   - Добавить уникальный идентификатор сделки (UUID или timestamp+symbol).  
   - Логировать режим работы (live/paper) и источник сигнала.
2. **Расширение тестов SL/TP**  
   - Проверка корректности расчёта при разных ATR и волатильности.  
   - Тесты на граничные значения (минимальный и максимальный стоп).
3. **Улучшение RiskGuard**  
   - Логирование причин блокировки сделки.  
   - Добавление тестов на дневной лимит и kill‑switch.
4. **Документация и контроль изменений**  
   - Обновление `PROJECT_INFO.md` и `changes.log` при каждом изменении логики.  
   - Автоматическая генерация отчёта по тестам.
5. **Подготовка к релизу 1.0**  
   - Финальный paper‑прогон.  
   - Подготовка к ограниченному live‑запуску.

---

### Версия 0.5 — предварительный план
- Интеграция дополнительных стратегий (RSI+EMA, SMA crossover).  
- Модуль анализа сделок и статистики.  
- Автоматическая оптимизация параметров стратегии.

## 4. Новые возможности (сентябрь 2025)
- **Система уведомлений**:
  - Новый модуль bot_ai/utils/notifier.py.
  - Поддержка провайдера Telegram (включается через config.json).
  - Вызовы в TradeExecutor (открытие/закрытие сделок).
  - Вызовы в RiskGuard (kill‑switch, cooldown, лимиты).
- **RiskGuard**:
  - Контроль дневного и общего лимита убытка.
  - Автоматическая установка cooldown на инструмент.
  - Блокировка открытия сделок при превышении лимитов.
- **TradeExecutor**:
  - Логирование сделок в CSV.
  - Автоматический расчёт SL/TP через DynamicSLTP.
  - Расчёт размера позиции через PositionSizer.
- **PositionSizer**:
  - Метод calculate_size(price) для совместимости с Executor.
  - Ограничение размера позиции по max_position_size_pct.

## 5. Структура проекта
bot_ai/  
  core/         # Конфиг, логирование  
  selector/     # Отбор и ротация пар  
  ml/           # Признаки и модель  
  strategy/     # Контроллер сигналов  
  exec/         # Исполнение сделок (TradeExecutor)  
  risk/         # RiskGuard, SL/TP, PositionSizer  
  utils/        # Notifier (уведомления)  
  diagnostics/  # Диагностика и тесты  
  backtest/     # Движок тестирования и сравнения стратегий  

logs/           # Логи  
data/           # История, кэш, результаты backtest  

## 6. Основные правила
- Любое изменение параметров риска → уведомление.
- Live‑режим только после успешного paper‑прогона.
- Лимиты на сделку и дневной стоп обязательны.
- Все изменения фиксируются в changes.log.
- Уведомления о сделках и рисках отправляются через Notifier.

## 7. Параметры по умолчанию
- max_per_trade_usdt: 25
- max_per_trade_pct: 0.5
- daily_loss_limit_usdt: 15
- max_spread_pct: 0.08
- min_24h_volume_usdt: 20_000_000
- notifications:
  - enabled: false
  - provider: telegram
  - telegram_token: ""
  - telegram_chat_id: ""

## 8. Обновление

### 2025‑09‑18
- Исправлен баг с повторным заголовком в `trades_log.csv` (метод `log_trade_to_csv` в `executor.py`).
- Все тесты пройдены успешно (`pytest -v` — 2/2 PASSED).
- Созданы резервные копии проекта:
  - `TradingBots_backup_1.zip` — перед обновлением паспорта.
  - `TradingBots_backup_2.zip` — после обновления паспорта.
- Дорожная карта обновлена до версии 0.4.

### 2025‑09‑18 — Добавлен тест состояния проекта
- Создан тест `tests/test_project_state.py`, который:
  - Сохраняет снимок текущего состояния проекта в файл `project_snapshot.txt`.
  - Фиксирует дату и время, версию проекта, последнее обновление из `PROJECT_INFO.md` и результат прогона тестов.
- **Когда запускать:** в конце каждой рабочей сессии перед созданием резервной копии.
- **Зачем:** чтобы при следующем открытии проекта сразу видеть, на чём остановились и что уже сделано.
- **Как запускать:**  
  ```powershell
  python -m pytest tests/test_project_state.py
### ### 📌 Состояние проекта — 2025‑09‑21 21:15

- **Версия проекта:** 0.3  
- **Последнее обновление паспорта:** 2025‑09‑18  
- **Результат тестов:** 10 passed, 1 failed  
- **Артефакты snapshot:** project_snapshot.txt, TradingBots_backup_3.zip  

#### 🟢 Что работает
- RiskGuard (лимиты, kill‑switch, cooldown).  
- Notifier (уведомления через Telegram).  
- TradeExecutor (логирование сделок).  

#### 🔴 Что требует внимания
- 1 упавший тест (см. pytest -v).  
- Требуется анализ и исправление до перехода к версии 0.4.  

#### 📂 Действия перед следующим этапом
1. Найти и исправить причину падения теста.  
2. Обновить PROJECT_INFO.md (раздел «Обновление»).  
3. Сделать новый snapshot после фикса.  
4. Зафиксировать Git‑тег `stage0.3_fix`.  
------ tests/test_smoke.py::test_smoke FAILED  - упал смок-тест                                                                                                                                                          [100%]
