## 5.1 Архитектура селектора пар

Модуль bot_ai/selector/ отвечает за выбор торговых пар.  
Он разделён на три уровня:

1. pipeline.py — оркестратор, управляет процессом отбора, сохраняет whitelist, экспортирует _trend_ok для обратной совместимости.  
2. filters.py — атомарные фильтры (spread_ok, volume_ok, riskguard_ok, trend_ok). Каждый можно отключить через skip_*.  
3. trend_utils.py — реализация проверки тренда через SMA. Используется фильтром trend_ok и проксируется в pipeline._trend_ok.  

Такое разделение устраняет циклические импорты, повышает читаемость и облегчает тестирование.

## 6. Основные правила
- Любое изменение параметров риска → уведомление.
- Live‑режим только после успешного paper‑прогона.
- Лимиты на сделку и дневной стоп обязательны.
- Все изменения фиксируются в changes.log.
- Уведомления о сделках и рисках отправляются через Notifier.

## 7. Параметры по умолчанию
- max_per_trade_usdt: 25
- max_per_trade_pct: 0.5
- daily_loss_limit_usdt: 15
- max_spread_pct: 0.08
- min_24h_volume_usdt: 20000000
- notifications:
  - enabled: false
  - provider: telegram
  - telegram_token: ""
  - telegram_chat_id: ""

## 8. Обновление

### 2025‑09‑18
- Исправлен баг с повторным заголовком в trades_log.csv (метод log_trade_to_csv в executor.py).
- Все тесты пройдены успешно (pytest -v — 2/2 PASSED).
- Созданы резервные копии проекта:
  - TradingBots_backup_1.zip — перед обновлением паспорта.
  - TradingBots_backup_2.zip — после обновления паспорта.
- Дорожная карта обновлена до версии 0.4.

### 2025‑09‑18 — Добавлен тест состояния проекта
- Создан тест tests/test_project_state.py, который:
  - Сохраняет снимок текущего состояния проекта в файл project_snapshot.txt.
  - Фиксирует дату и время, версию проекта, последнее обновление из PROJECT_INFO.md и результат прогона тестов.
- Когда запускать: в конце каждой рабочей сессии перед созданием резервной копии.
- Зачем: чтобы при следующем открытии проекта сразу видеть, на чём остановились и что уже сделано.
- Как запускать:
  python -m pytest tests/test_project_state.py

### 2025‑09‑21 — Состояние проекта
- Версия проекта: 0.3
- Последнее обновление паспорта: 2025‑09‑18
- Результат тестов: 10 passed, 1 failed
- Артефакты snapshot: project_snapshot.txt, TradingBots_backup_3.zip

🟢 Работает: RiskGuard, Notifier, TradeExecutor  
🔴 Требует внимания: 1 упавший тест (pytest -v)  

Действия:
1. Найти и исправить причину падения теста.
2. Обновить PROJECT_INFO.md (раздел «Обновление»).
3. Сделать новый snapshot после фикса.
4. Зафиксировать Git‑тег stage0.3_fix.

### 2025‑09‑23 — stage0.4_dev
- RiskGuard:
  - Исправлена обработка cfg.get (поддержка dict и Config).
  - Добавлена поддержка кулдауна по символам.
  - Локализованы сообщения (русский язык) для логов и CSV.
- Все тесты успешно пройдены (pytest -v → 12/12 passed).
- Зафиксирован Git‑тег stage0.4_dev.
- Переход к версии 0.4 (in progress).
