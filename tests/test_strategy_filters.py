# tests/test_strategy_filters.py# ===============================# ? Р В Р’В Р РЋРЎвЂєР В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РЎвЂњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р Р†Р вЂљРІвЂћвЂ“ Р В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’В»Р В Р Р‹Р В Р РЏ Р В Р Р‹Р Р†Р вЂљРЎвЂєР В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’В»Р В Р Р‹Р В Р вЂ°Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В  Р В Р Р‹Р В РЎвЂњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р вЂ™Р’ВµР В Р’В Р РЋРІР‚вЂњР В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚В (Р В Р Р‹Р Р†Р вЂљРЎвЂєР В Р’В Р РЋРІР‚ВР В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В»Р В Р Р‹Р В Р вЂ°Р В Р’В Р В РІР‚В¦Р В Р Р‹Р Р†Р вЂљРІвЂћвЂ“Р В Р’В Р Р†РІР‚С›РІР‚вЂњ Р В Р’В Р вЂ™Р’В±Р В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚СћР В Р’В Р РЋРІР‚Сњ):# - TrendFilter# - VolatilityFilter# - classify_market_regime# - mtf_filter (sma, ema, adx, rsi)# ===============================import pytestimport pandas as pdimport randomfrom bot_ai.filters.trend_filter import TrendFilterfrom bot_ai.filters.volatility_filter import VolatilityFilterfrom bot_ai.filters.regime_classifier import classify_market_regimefrom bot_ai.filters.mtf_filter import mtf_filter# === TrendFilter ===def test_trend_filter_passes_on_strong_trend():`n    pass    df = pd.DataFrame({        "high":  [101, 102, 103, 104, 105, 106, 107, 108, 109, 110],        "low":   [ 99, 100, 101, 102, 103, 104, 105, 106, 107, 108],        "close": [100, 101, 102, 103, 104, 105, 106, 107, 108, 109]    })    trend = TrendFilter(adx_window=3, adx_threshold=10)    result = trend.apply(df)    print("\nTREND PASS:\n", result.tail())    assert result.iloc[-1] == Truedef test_trend_filter_blocks_on_flat_market():`n    pass    df = pd.DataFrame({        "high":  [100] * 10,        "low":   [100] * 10,        "close": [100] * 10    })    trend = TrendFilter(adx_window=3, adx_threshold=10)    result = trend.apply(df)    print("\nTREND BLOCK:\n", result.tail())    assert result.iloc[-1] == False# === VolatilityFilter ===def test_volatility_filter_passes_on_high_atr():`n    pass    df = pd.DataFrame({        "high":  [105, 106, 107, 108, 109, 110, 111, 112, 113, 114],        "low":   [ 95,  96,  97,  98,  99, 100, 101, 102, 103, 104],        "close": [100, 101, 102, 103, 104, 105, 106, 107, 108, 109]    })    vf = VolatilityFilter(atr_window=3, atr_threshold=0.01)    result = vf.apply(df)    print("\nVOLATILITY PASS:\n", result.tail())    assert result.iloc[-1] == Truedef test_volatility_filter_blocks_on_low_atr():`n    pass    df = pd.DataFrame({        "high":  [100.1] * 10,        "low":   [ 99.9] * 10,        "close": [100.0] * 10    })    vf = VolatilityFilter(atr_window=3, atr_threshold=0.01)    result = vf.apply(df)    print("\nVOLATILITY BLOCK:\n", result.tail())    assert result.iloc[-1] == False# === Regime Classifier ===def test_regime_trend_high_vol():`n    pass    random.seed(42)    prices = [100 * (1.02 ** i) * (1 + random.uniform(-0.05, 0.05)) for i in range(60)]    result = classify_market_regime(prices)    print("\nREGIME TREND HIGH VOL:", result)    assert result == "trend_high_vol"def test_regime_flat_low_vol():`n    pass    prices = [100 + (0.1 if i % 2 == 0 else -0.1) for i in range(60)]    result = classify_market_regime(prices)    print("\nREGIME FLAT LOW VOL:", result)    assert result == "flat_low_vol"def test_regime_unknown_on_short_series():`n    pass    prices = list(range(50))    result = classify_market_regime(prices)    print("\nREGIME UNKNOWN:", result)    assert result == "unknown"# === MTF Filter ===def test_mtf_filter_sma_long_passes():`n    pass    df = pd.DataFrame({"close": list(range(100, 160))})    result = mtf_filter(df, method="sma", period=20, direction="long")    print("\nMTF SMA LONG:", result)    assert result == Truedef test_mtf_filter_ema_short_passes():`n    pass    df = pd.DataFrame({"close": list(range(160, 100, -1))})    result = mtf_filter(df, method="ema", period=20, direction="short")    print("\nMTF EMA SHORT:", result)    assert result == Truedef test_mtf_filter_adx_passes():`n    pass    df = pd.DataFrame({        "high":  [105, 106, 107, 108, 109, 110, 111, 112, 113, 114],        "low":   [ 95,  96,  97,  98,  99, 100, 101, 102, 103, 104],        "close": [100, 101, 102, 103, 104, 105, 106, 107, 108, 109]    })    result = mtf_filter(df, method="adx", period=3)    print("\nMTF ADX:", result)    assert result == Truedef test_mtf_filter_rsi_short_blocks():`n    pass    df = pd.DataFrame({"close": [70 - i for i in range(60)]})    result = mtf_filter(df, method="rsi", period=14, direction="short")    print("\nMTF RSI SHORT:", result)    assert result == True




