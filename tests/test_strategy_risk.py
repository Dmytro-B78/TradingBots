# tests/test_strategy_risk.py# Р В Р’В Р РЋРЎСџР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В°, Р В Р Р‹Р Р†Р вЂљР Р‹Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚Сћ RiskGuard Р В Р’В Р вЂ™Р’В±Р В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚СћР В Р’В Р РЋРІР‚СњР В Р’В Р РЋРІР‚ВР В Р Р‹Р В РІР‚С™Р В Р Р‹Р РЋРІР‚СљР В Р’В Р вЂ™Р’ВµР В Р Р‹Р Р†Р вЂљРЎв„ў Р В Р Р‹Р В РЎвЂњР В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’ВµР В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚СњР В Р’В Р РЋРІР‚В Р В Р’В Р РЋРІР‚вЂќР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚В Р В Р’В Р РЋРІР‚вЂќР В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В Р В Р Р‹Р Р†Р вЂљРІвЂћвЂ“Р В Р Р‹Р Р†РІР‚С™Р’В¬Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚В Р В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋР’ВР В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р вЂ™Р’В°import pytestfrom bot_ai.execution.executor import TradeExecutorclass DummyRiskGuard:    def __init__(self, allow=True):`n    pass        self.allow = allow        self.validate_called = False    def validate(self, trade: dict) -> bool:        self.validate_called = True        return self.allowdef test_trade_blocked_by_risk_guard():`n    pass    risk_guard = DummyRiskGuard(allow=False)    executor = TradeExecutor(risk_guard=risk_guard)    trade = {        "symbol": "BTCUSDT",        "side": "BUY",        "price": 50000,        "qty": 0.01    }    with pytest.raises(PermissionError, match="RiskGuard"):        executor.log_trade_to_csv(trade, signal_source="test")    assert risk_guard.validate_called is Truedef test_trade_allowed_by_risk_guard(tmp_path):`n    pass    log_file = tmp_path / "trades.csv"    risk_guard = DummyRiskGuard(allow=True)    executor = TradeExecutor(risk_guard=risk_guard, log_file=log_file)    trade = {        "symbol": "BTCUSDT",        "side": "SELL",        "price": 51000,        "qty": 0.02    }    executor.log_trade_to_csv(trade, signal_source="test")    assert log_file.exists()    content = log_file.read_text()    assert "BTCUSDT" in content    assert "SELL" in content    assert "test" in content




