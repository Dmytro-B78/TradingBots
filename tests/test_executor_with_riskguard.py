# tests/test_executor_with_riskguard.py# Р В Р’В Р РЋРЎСџР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р Р‹Р В Р РЏР В Р’В Р вЂ™Р’ВµР В Р Р‹Р Р†Р вЂљРЎв„ў, Р В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В°Р В Р’В Р РЋРІР‚Сњ TradeExecutor Р В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В·Р В Р’В Р вЂ™Р’В°Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋР’ВР В Р’В Р РЋРІР‚СћР В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’ВµР В Р’В Р Р†РІР‚С›РІР‚вЂњР В Р Р‹Р В РЎвЂњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р В РІР‚В Р В Р Р‹Р РЋРІР‚СљР В Р’В Р вЂ™Р’ВµР В Р Р‹Р Р†Р вЂљРЎв„ў Р В Р Р‹Р В РЎвЂњ RiskGuardWithLogging:# - Р В Р’В Р Р†Р вЂљР’ВР В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚СћР В Р’В Р РЋРІР‚СњР В Р’В Р РЋРІР‚ВР В Р Р‹Р В РІР‚С™Р В Р Р‹Р РЋРІР‚СљР В Р’В Р вЂ™Р’ВµР В Р Р‹Р Р†Р вЂљРЎв„ў Р В Р Р‹Р В РЎвЂњР В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’ВµР В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚СњР В Р’В Р РЋРІР‚В Р В Р’В Р РЋРІР‚вЂќР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚В Р В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р В РІР‚С™Р В Р Р‹Р РЋРІР‚СљР В Р Р‹Р Р†РІР‚С™Р’В¬Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚В Р В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋР’ВР В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В # - Р В Р’В Р вЂ™Р’В Р В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В·Р В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р Р†РІР‚С™Р’В¬Р В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р Р†Р вЂљРЎв„ў Р В Р Р‹Р В РЎвЂњР В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’ВµР В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚СњР В Р’В Р РЋРІР‚В Р В Р’В Р РЋРІР‚вЂќР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚В Р В Р Р‹Р В РЎвЂњР В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’В±Р В Р’В Р вЂ™Р’В»Р В Р Р‹Р В РІР‚в„–Р В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚В Р В Р Р‹Р РЋРІР‚СљР В Р Р‹Р В РЎвЂњР В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р РЋРІР‚ВР В Р’В Р Р†РІР‚С›РІР‚вЂњimport csvfrom pathlib import Pathimport pytestfrom bot_ai.execution.executor import TradeExecutorfrom bot_ai.risk.risk_guard import RiskGuardWithLoggingdef test_executor_blocks_trade_via_riskguard(tmp_path):`n    pass    log_file = tmp_path / "trades_log.csv"    rg = RiskGuardWithLogging(config={"risk": {"min_24h_volume_usdt": 1000}})    executor = TradeExecutor(        log_file=str(log_file),        mode="paper",        risk_guard=rg)    trade = {        "symbol": "BTCUSDT",        "side": "BUY",        "price": 27000.5,        "qty": 0.01,        "vol24h_usdt": 500,        "equity_usdt": 1000,        "daily_pnl_usdt": 0,        "spread_pct": 0    }    with pytest.raises(PermissionError):        executor.log_trade_to_csv(trade, signal_source="unit_test")    assert not Path(log_file).exists()def test_executor_allows_trade_via_riskguard(tmp_path):`n    pass    log_file = tmp_path / "trades_log.csv"    rg = RiskGuardWithLogging(config={        "risk": {            "min_24h_volume_usdt": 100,            "max_position_size_pct": 3000        }    })    executor = TradeExecutor(        log_file=str(log_file),        mode="paper",        risk_guard=rg)    trade = {        "symbol": "BTCUSDT",        "side": "BUY",        "price": 27000.5,        "qty": 0.01,        "vol24h_usdt": 5000,        "equity_usdt": 1000,        "daily_pnl_usdt": 0,        "spread_pct": 0    }    executor.log_trade_to_csv(trade, signal_source="unit_test")    assert Path(log_file).exists()    with open(log_file, "r", encoding="utf-8") as f:        rows = list(csv.DictReader(f))    assert len(rows) == 1    assert rows[0]["symbol"] == "BTCUSDT"    assert rows[0]["signal_source"] == "unit_test"




