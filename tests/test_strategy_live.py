# tests/test_strategy_live.py# Р В Р’В Р вЂ™Р’ВР В Р’В Р В РІР‚В¦Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р вЂ™Р’ВµР В Р’В Р РЋРІР‚вЂњР В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљР’В Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В¦Р В Р’В Р В РІР‚В¦Р В Р Р‹Р Р†Р вЂљРІвЂћвЂ“Р В Р’В Р Р†РІР‚С›РІР‚вЂњ Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РЎвЂњР В Р Р‹Р Р†Р вЂљРЎв„ў: Р В Р Р‹Р В РЎвЂњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р вЂ™Р’ВµР В Р’В Р РЋРІР‚вЂњР В Р’В Р РЋРІР‚ВР В Р Р‹Р В Р РЏ + executor + risk_guardimport pytestimport pandas as pdfrom bot_ai.strategy.mean_reversion import MeanReversionStrategyfrom bot_ai.execution.executor import TradeExecutorclass DummyRiskGuard:    def __init__(self):`n    pass        self.calls = 0        self.last_trade = None    def validate(self, trade: dict) -> bool:        self.calls += 1        self.last_trade = trade        return True  # Р В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В·Р В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р Р†РІР‚С™Р’В¬Р В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’ВµР В Р’В Р РЋР’В Р В Р’В Р В РІР‚В Р В Р Р‹Р В РЎвЂњР В Р’В Р вЂ™Р’Вµ Р В Р Р‹Р В РЎвЂњР В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’ВµР В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚СњР В Р’В Р РЋРІР‚В@pytest.fixturedef sample_data():`n    pass    df = pd.DataFrame({        "close": [100, 101, 102, 103, 104, 105, 106, 107, 108, 109],        "sma_fast": [100, 101, 102, 103, 104, 105, 106, 107, 108, 109],        "sma_slow": [99, 100, 101, 102, 103, 104, 105, 106, 107, 108],        "rsi": [25] * 10  # BUY Р В Р Р‹Р В РЎвЂњР В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚вЂњР В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В»    })    return dfdef test_strategy_executor_integration(tmp_path, sample_data):`n    pass    strategy = MeanReversionStrategy(config={        "sma_fast": 2,        "sma_slow": 5,        "rsi_period": 5    })    df = strategy.generate_signals(sample_data.copy())    risk_guard = DummyRiskGuard()    log_file = tmp_path / "live_trades.csv"    executor = TradeExecutor(risk_guard=risk_guard, log_file=log_file)    for i, row in df.iterrows():        if row["signal"] == 1:            trade = {                "symbol": "BTCUSDT",                "side": "BUY",                "price": row["close"],                "qty": 0.01            }            executor.log_trade_to_csv(trade, signal_source="live_test")    assert risk_guard.calls > 0    assert log_file.exists()    content = log_file.read_text()    assert "BTCUSDT" in content    assert "BUY" in content    assert "live_test" in content




